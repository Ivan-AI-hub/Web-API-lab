@using Whosales.Domain
@model Product
@{
	Layout = "ProductLayout";
}

@if (Model != null)
{
	<h4>Информация о @Model.Name
		@if (this.User.IsInRole("admin"))
		{
			@Html.ActionLink("Обновить информацию", "Update", "Product", new {id = Model.ProductId}, new {@class="btn btn-sm btn-primary"})
		}
	</h4>
	<div>Название : @Html.DisplayFor(x => x.Name)</div>
	<div>Производитель : @Html.DisplayFor(x => x.Manufacturer.Name)</div>
	<div>Тип товара : @Html.DisplayFor(x => x.Type.Name)</div>
	<div>Условия хранения : @Html.DisplayFor(x => x.StorageConditions)</div>
	<div>Упаковка : @Html.DisplayFor(x => x.Package)</div>
	<div>Срок годности : @Html.DisplayFor(x => x.StorageLife)</div>
	<div>
		<table class="table">
			<tr>
				<td>Склад</td>
				<td>Количество получено на склад</td>
				<td>Количество реализовано со склада</td>
				<td>Остаток</td>
			</tr>
			@foreach (var report in
					from e in Model.ReceiptReports
					join d in Model.ReleaseReports
					on e.StorageId equals d.StorageId into empDept
					from ed in empDept.DefaultIfEmpty()
					orderby e.Storage.Name
					select new
					{
						storageid = e.StorageId,
						storageName = e.Storage.Name,
						receiptVolume = e.Volume,
						releaseVolume = ed == null ? 0 : ed.Volume,
						remains = e.Volume - (ed == null ? 0 : ed.Volume)
					}
					)
			{
				<tr>
					<td>@report.storageName</td>
					<td>@report.receiptVolume</td>
					<td>@report.releaseVolume</td>
					<td>@report.remains</td>
					@if (this.User.IsInRole("admin"))
					{
						<td>@Html.ActionLink("Добавить получение", "Add", "ReceiptReport", new{selectedProductId = Model.ProductId, selectedStorageId = report.storageid}, new {@class="btn btn-sm btn-primary"})</td>
						<td>@Html.ActionLink("Добавить реализацию", "Add", "ReleaseReport", new{selectedProductId = Model.ProductId, selectedStorageId = report.storageid}, new {@class="btn btn-sm btn-primary"})</td>
					}
				</tr>
			}
		</table>
	</div>
}
else
{
	<h2>Товара не обнаружено</h2>
}
